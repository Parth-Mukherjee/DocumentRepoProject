@model DocumentViewModel

<div class="container mt-3">
    <div class="col-lg-12 row">
        @*         <form asp-action="AddDocument" asp-controller="Document" method="post" enctype="multipart/form-data" class="d-flex flex-wrap">
        <form class="d-flex flex-wrap">*@
            <div class="col-auto me-3">
                <label asp-for="documentName" class="form-label me-2"></label>
                <input asp-for="documentName" class="form-control" />
                <input type="hidden" asp-for="documentID" />
                <span asp-validation-for="documentName" class="text-danger"></span>
            </div>
            <div class="col-auto me-3">
                <label asp-for="documentCode" class="form-label me-2"></label>
                <input asp-for="documentCode" class="form-control" />
                <span asp-validation-for="documentCode" class="text-danger"></span>
            </div>
            <div class="col-auto me-3">
                <label asp-for="uploadedFile" class="form-label me-2"></label>
                <input asp-for="uploadedFile" class="form-control" type="file" />
                <span asp-validation-for="uploadedFile" class="text-danger"></span>
            </div>
            <div class="col-auto align-self-end">
                <button type="submit" id="UploadBtn" class="btn btn-primary">Upload</button>
            </div>
        @* </form> *@
        <div id="error-message" class="text-danger mt-4"></div>

    </div>
</div>

<partial name="_DocumentDetailsListView" model="Model.documentDetailList"></partial>


<script>
    $("#UploadBtn").click(function () {
        debugger;
        var DocumentName = $("#documentName").val();
        var DocumentCode = $("#documentCode").val();
        if (DocumentName == "") {
            alert("Document Name can't be empty");
            return false;
        }
        if (DocumentCode == "") {
            alert("Document Code can't be empty");
            return false;
        }

        if ($("#documentID").val() == "") {
            alert("Submit Case");
            //For checking the Supported file extension
            var file = $("#uploadedFile")[0].files[0];
            if (file.size === 0) {
                alert("Uploaded File is empty, Kindly try with different file");
                return false;
            }
            else {
                var fileName = $('#uploadedFile').val().split('\\').pop();
                var documentExtension = fileName.split('.').pop().toLowerCase();

                if (documentExtension != "pdf" && documentExtension != "xlsx" && documentExtension != "xls") {
                    alert("Invalid file type. Only Excel and PDF files are allowed");
                    return false;
                }
                if ((file.size / 1024 / 1024) > 5) {
                    alert("File size greater then 5 MB");
                    return false;
                }
            }
        }
        else {
            if (file.size !== 0) {
                var fileName = $('#uploadedFile').val().split('\\').pop();
                var documentExtension = fileName.split('.').pop().toLowerCase();

                if (documentExtension != "pdf" && documentExtension != "xlsx" && documentExtension != "xls") {
                    alert("Invalid file type. Only Excel and PDF files are allowed");
                    return false;
                }
                if ((file.size / 1024 / 1024) > 5) {
                    alert("File size greater then 5 MB");
                    return false;
                }
            }

        }


    });


    $(document).ready(function () {

        //Check For document Name Length and Special Characters
        $("#documentName").on('keypress', function (e) {
            var keyCode = e.which;
            var documentName = $("#documentName").val();

            //Check documentLength should not be greater then 50 , and notify the user for the same .
            if ((documentName.length + 1) > 50) {
                $("#error-message").text("Maximum 50 characters allowed for Document Name");
                return false;
            }
            else {
                $("#error-message").text("");
            }

            // Check for alphanumeric characters (a-z, A-Z, 0-9) , and notify the user for the same .
            if (!((keyCode >= 48 && keyCode <= 57) || // numbers
                (keyCode >= 65 && keyCode <= 90) || // uppercase letters
                (keyCode >= 97 && keyCode <= 122))) { // lowercase letters
                $("#error-message").text("Only alphanumeric characters are allowed.");
                e.preventDefault();
            } else {
                $("#error-message").text("");
            }
        });


        //Check For document Code Length and only characters allowed
        $("#documentCode").on('keypress', function (e) {
            var keyCode = e.which;

            //Check documentLength should not be greater then 3 , and notify the user for the same .
            var a = $("#documentCode").val();
            if ((a.length + 1) > 3) {
                $("#error-message").text("Maximum 3 characters allowed for Document Code");
                return
            }
            else {
                $("#error-message").text("");
            }


            // Check for characters (a-z, A-Z)
            if (!(
                (keyCode >= 65 && keyCode <= 90) || // uppercase letters
                (keyCode >= 97 && keyCode <= 122))) { // lowercase letters
                $("#error-message").text("Only characters are allowed for Document Code");
                e.preventDefault();
            } else {
                $("#error-message").text("");
            }
        });

    });

    // $("#editDocument").click(function () {
    //     alert("Hello");
    // });

    function functiontest(documentId) {
        // alert(documentId);
        debugger;
        $.ajax({
            url: '/Document/GetDocumentData',
            type: 'GET',
            data: { documentID: documentId },
            success: function (data) {
                $("#documentName").val(data.documentName);
                $("#documentCode").val(data.documentCode);
                $("#hiddenDocumentIDForUpdate").val(documentId);
                //alert($("#hiddenDocumentIDForUpdate").val());
            }
        });
    }


    $("#UploadBtn").click(function () {
        debugger;
        var documentId = $("#documentID").val();
        var documentViewModel = {
            documentID: documentId,
            documentCode: $("#documentCode").val(),
            documentName: $("#documentName").val(),
            uploadedFile: $("#uploadedFile")[0].files[0]
        };

        $.ajax({
            url: '/Document/UpdateDocumentData',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(documentViewModel),
            success: function (data) {
                alert(data);
                //alert($("#hiddenDocumentIDForUpdate").val());
            }
        });
    });

</script>
